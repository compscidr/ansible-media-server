---
- name: Create Transmission Directories
  tags: transmission
  become: true
  ansible.builtin.file:
    path: "{{ transmission_folder }}"
    state: directory
    mode: "755"
    owner: root
    group: root

- name: Create default transmission .env file
  tags: transmission
  become: true
  ansible.builtin.copy:
    content: |
      # Transmission environment variables
      # Add your OpenVPN credentials and configuration here
    dest: "{{ transmission_env_file }}"
    mode: "600"
    force: false

- name: Deploy transmission
  tags: transmission
  become: true
  community.docker.docker_container:
    name: transmission
    image: haugene/transmission-openvpn:latest
    pull: true
    ports:
      - "{{ transmission_port }}:9091"
    restart_policy: unless-stopped
    devices:
      - /dev/net/tun
    capabilities:
      - NET_ADMIN
    volumes:
      - "{{ transmission_downloads_folder }}:/data"
      - "{{ transmission_folder }}:/config"
    env:
      TZ: "{{ transmission_tz }}"
      PUID: "{{ transmission_pid }}"
      PGID: "{{ transmission_gid }}"
    env_file: "{{ transmission_env_file }}"
